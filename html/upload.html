<html>
<head>
<title>Upload a file</title>
</head>
<script type="text/javascript">
window.onload = function() {

var picker = document.getElementById('picker')
var box = document.getElementById('box')
var upload = document.getElementById('upload')

picker.onchange = function() {
	while(box.firstChild != undefined) {
		box.removeChild(box.firstChild)
	}

	for(var i = 0; i < picker.files.length; ++i) {
		var f = document.createElement('div')
		f.className = 'file'
		f.innerText = picker.files[i].name
		if(picker.files[i].type.match(/^image/)) {
			f.style.backgroundImage = 'url(' + 
				window.URL.createObjectURL(picker.files[i]) +
				')'
		}
		else {
			f.style.backgroundImage = 
				'url(http://3.bp.blogspot.com/-sY7whMXT83o/UECGK-oSdeI/AAAAAAAAABM/-OXkkmppfvE/s1600/text-file-icon.png)'
			f.style.backgroundSize = '50%'
		}

		box.appendChild(f)
	}
}


upload.onclick = function() {
	if(picker.files.length == 0) {
		return
	}


	var lastfile = 0
	var fun = function() {
		if(this.readyState != 4) return;

		if(lastfile == picker.files.length) {
			alert('Done')
		} else {
		
			var f = new XMLHttpRequest()
			f.onreadystatechange = fun
			f.open('POST', '/', true)
			f.send(picker.files[lastfile])
			lastfile++
		}

	}



	var req = new XMLHttpRequest()
	req.onreadystatechange = fun
	req.open('POST', '/', true);

	var s = picker.files.length + '\n'
	for(var i = 0; i < picker.files.length; ++i) {
		s += picker.files[i].size + ' ' + picker.files[i].type + ' ' +
			picker.files[i].name + '\n'
	}

	req.send(s)

}



}
</script>
<style>
body {
	text-align: center;
	padding: 50px;

}


#box {
	padding: 10px;
	margin: auto;
	display: block;
	text-align: center;
}
#box * {
	background-repeat: no-repeat;
	background-position: center;
	background-size: cover;
}

.file {
	border: 1px solid gray;
	display: inline-block;
	width: 300px;
	height: 300px;
	margin: 5px;
}

</style>
<body>
<input id="picker" type="file" multiple />
<button id="upload">Upload</button>
<span id="box"></span>
</body>
</html>
